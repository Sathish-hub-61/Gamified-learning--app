<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Body Quest - PlayLearn</title>
    <link rel="stylesheet" href="css/global.css">
    <style>
        body {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            font-family: 'Outfit', sans-serif;
            margin: 0;
        }

        .game-container {
            background: white;
            border-radius: 35px;
            padding: 40px;
            max-width: 900px;
            width: 100%;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.2);
            display: flex;
            gap: 40px;
            position: relative;
            min-height: 600px;
        }

        .body-viewport {
            flex: 1;
            position: relative;
            background: #fffafa;
            border-radius: 25px;
            border: 3px solid #ff758c;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .anatomy-svg {
            height: 100%;
            max-width: 100%;
        }

        .organ-click {
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        .organ-click:hover {
            filter: brightness(1.2);
            transform: scale(1.05);
            transform-origin: center;
        }

        .organ-click.solved {
            opacity: 0.5;
            pointer-events: none;
        }

        /* Quest Panel */
        .quest-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .header-box {
            margin-bottom: 30px;
        }

        .badge-new {
            background: #ff758c;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .game-title {
            color: #2d3748;
            font-size: 2.5rem;
            margin: 10px 0;
            font-weight: 800;
        }

        .mission-box {
            background: #f8fafc;
            border-radius: 20px;
            padding: 25px;
            border-left: 5px solid #ff758c;
            margin-bottom: 25px;
        }

        .mission-title {
            color: #ff758c;
            font-weight: 800;
            margin-bottom: 10px;
            display: block;
        }

        .option-stack {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .btn-option {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 18px;
            border-radius: 15px;
            font-weight: 600;
            text-align: left;
            transition: all 0.2s;
            cursor: pointer;
            color: #4a5568;
        }

        .btn-option:hover {
            border-color: #ff758c;
            background: #fff5f7;
            transform: translateX(5px);
        }

        .btn-option.correct {
            background: #c6f6d5;
            border-color: #48bb78;
            color: #22543d;
        }

        .btn-option.wrong {
            background: #fed7d7;
            border-color: #f56565;
            color: #742a2a;
        }

        .back-nav {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.8rem;
            text-decoration: none;
            z-index: 100;
        }

        .stat-badge {
            position: absolute;
            top: 20px;
            right: 40px;
            background: #fef3c7;
            padding: 8px 18px;
            border-radius: 15px;
            font-weight: 800;
            color: #d97706;
        }

        /* Result Screen */
        .result-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            border-radius: 35px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
            text-align: center;
        }
    </style>
</head>

<body>
    <a href="game-hub.html" class="back-nav">üè†</a>
    <button id="mute-toggle" class="btn-mute"
        style="position: fixed; bottom: 20px; right: 20px; font-size: 20px; background: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; box-shadow: var(--shadow-md); z-index: 1000;">üîä</button>

    <div class="game-container">
        <div class="stat-badge">‚≠ê <span id="star-val">0</span></div>

        <div class="body-viewport">
            <svg class="anatomy-svg" viewBox="0 0 800 600" preserveAspectRatio="xMidYMid meet">
                <defs>
                    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                        <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.1" />
                    </filter>
                </defs>

                <!-- Center Body Illustration -->
                <g transform="translate(250, 40)">
                    <!-- Body Silhouette -->
                    <path d="M150 20 Q180 20 180 60 Q180 80 150 80 Q120 80 120 60 Q120 20 150 20" fill="#fff1e6"
                        stroke="#fb7185" stroke-width="3" /> <!-- Head -->
                    <path d="M135 75 L135 90 L165 90 L165 75" fill="#fff1e6" stroke="#fb7185" stroke-width="3" />
                    <!-- Neck -->
                    <path
                        d="M135 90 Q100 95 90 140 L80 250 L100 250 L110 160 L120 160 L120 300 Q120 320 100 350 L100 500 L140 500 L140 350 L160 350 L160 500 L200 500 L200 350 Q180 320 180 300 L180 160 L190 160 L200 250 L220 250 L210 140 Q200 95 165 90 Z"
                        fill="#fff1e6" stroke="#fb7185" stroke-width="3" />

                    <!-- Decorative Internal Organs (Visual Context) -->
                    <g opacity="0.6">
                        <circle cx="150" cy="50" r="15" fill="#fbcfe8" /> <!-- Brain loc -->
                        <path d="M130,140 Q110,160 110,200 Q140,200 145,160 Z" fill="#bfdbfe" /> <!-- Lung L -->
                        <path d="M170,140 Q190,160 190,200 Q160,200 155,160 Z" fill="#bfdbfe" /> <!-- Lung R -->
                        <circle cx="160" cy="180" r="10" fill="#fecaca" /> <!-- Heart loc -->
                        <circle cx="150" cy="240" r="15" fill="#fde68a" /> <!-- Stomach loc -->
                    </g>
                </g>

                <!-- Connectivity Lines -->
                <g stroke="#94a3b8" stroke-width="2" stroke-dasharray="6,6">
                    <line x1="160" y1="100" x2="380" y2="90" /> <!-- Brain -->
                    <line x1="160" y1="200" x2="370" y2="200" /> <!-- Lungs -->
                    <line x1="160" y1="350" x2="390" y2="280" /> <!-- Stomach -->

                    <line x1="640" y1="200" x2="420" y2="220" /> <!-- Heart -->
                    <line x1="640" y1="350" x2="410" y2="260" /> <!-- Liver -->
                </g>

                <!-- Radial Interactive Modules -->

                <!-- 1. Brain (Top Left) -->
                <g id="org-brain" class="organ-click" onclick="loadQuest('brain')" filter="url(#shadow)">
                    <circle cx="160" cy="100" r="40" fill="#fff" stroke="#fbcfe8" stroke-width="4" />
                    <text x="160" y="105" font-size="30" text-anchor="middle" dominant-baseline="middle">üß†</text>
                    <text x="160" y="155" font-size="14" font-weight="bold" fill="#64748b"
                        text-anchor="middle">BRAIN</text>
                </g>

                <!-- 2. Lungs (Middle Left) -->
                <g id="org-lungs" class="organ-click" onclick="loadQuest('lungs')" filter="url(#shadow)">
                    <circle cx="160" cy="200" r="40" fill="#fff" stroke="#bfdbfe" stroke-width="4" />
                    <text x="160" y="205" font-size="30" text-anchor="middle" dominant-baseline="middle">ü´Å</text>
                    <text x="160" y="255" font-size="14" font-weight="bold" fill="#64748b"
                        text-anchor="middle">LUNGS</text>
                </g>

                <!-- 3. Heart (Top Right) -->
                <g id="org-heart" class="organ-click" onclick="loadQuest('heart')" filter="url(#shadow)">
                    <circle cx="640" cy="200" r="40" fill="#fff" stroke="#fecaca" stroke-width="4" />
                    <text x="640" y="205" font-size="30" text-anchor="middle" dominant-baseline="middle">‚ù§Ô∏è</text>
                    <text x="640" y="255" font-size="14" font-weight="bold" fill="#64748b"
                        text-anchor="middle">HEART</text>
                </g>

                <!-- 4. Liver (Bottom Right) -->
                <g id="org-liver" class="organ-click" onclick="loadQuest('liver')" filter="url(#shadow)">
                    <circle cx="640" cy="350" r="40" fill="#fff" stroke="#fed7aa" stroke-width="4" />
                    <image href="assets/images/liver.svg" x="615" y="325" width="50" height="50" />
                    <text x="640" y="405" font-size="14" font-weight="bold" fill="#64748b"
                        text-anchor="middle">LIVER</text>
                </g>

                <!-- 5. Stomach (Bottom Left) -->
                <g id="org-stomach" class="organ-click" onclick="loadQuest('stomach')" filter="url(#shadow)">
                    <circle cx="160" cy="350" r="40" fill="#fff" stroke="#fde68a" stroke-width="4" />
                    <image href="assets/images/Stomach.svg" x="135" y="325" width="50" height="50" />
                    <text x="160" y="405" font-size="14" font-weight="bold" fill="#64748b"
                        text-anchor="middle">STOMACH</text>
                </g>

            </svg>
        </div>

        <div class="quest-panel">
            <div id="intro-view">
                <div class="header-box">
                    <span class="badge-new">Biology</span>
                    <h1 class="game-title">Body Quest</h1>
                </div>
                <p style="color: #64748b; font-size: 1.1rem; line-height: 1.6;">
                    Inside your body, everything works together like a big team!
                    <br><br>
                    <b>Tap an organ</b> on the body map to start a mission and help your body stay healthy.
                    <br><br>
                    Can you solve all 5 missions?
                </p>
            </div>

            <div id="quest-view" style="display: none;">
                <div class="mission-box">
                    <span class="mission-title" id="m-label">MISSION: BRAIN</span>
                    <p id="m-question" style="margin:0; font-weight: 700; color: #1e293b; font-size: 1.2rem;"></p>
                </div>

                <div class="option-stack" id="m-options">
                    <!-- Options -->
                </div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="result-screen">
            <div style="font-size: 5rem; margin-bottom: 20px;">üéâ</div>
            <h1 style="font-size: 3rem; color: #2d3748;">Body Master!</h1>
            <p style="color: #64748b; font-size: 1.2rem;">You completed all missions and helped the body stay healthy!
            </p>
            <div style="font-size: 3.5rem; font-weight: 900; color: #ff758c; margin: 30px 0;">‚≠ê <span
                    id="total-stars">0</span></div>
            <button class="btn btn-primary" style="padding: 15px 40px;"
                onclick="window.location.href='game-hub.html'">Back to Hub</button>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/progress-service.js"></script>
    <script src="js/progress-tracker.js"></script>
    <script src="js/audio-manager.js"></script>
    <script>
        const GAME_ID = 'body-quest';
        const tracker = new ProgressTracker();
        const audio = new AudioManager();
        audio.initBackgroundMusic();

        document.getElementById('mute-toggle').addEventListener('click', () => {
            audio.toggleMute();
            audio.playSound('click');
        });
        let stars = 0;
        let solved = new Set();

        const quests = {
            brain: {
                label: "THE BRAIN üß†",
                q: "Your brain is the control center! How can you help it stay sharp and focused after school?",
                opts: [{ t: "Get 9 hours of sleep", c: true }, { t: "Watch 5 hours of TV", c: false }, { t: "Eat only candy", c: false }]
            },
            heart: {
                label: "THE HEART ‚ù§Ô∏è",
                q: "Your heart is a strong pump! What's the best way to keep it beating strong?",
                opts: [{ t: "Play outside and run", c: true }, { t: "Sit still all day", c: false }, { t: "Drink extra soda", c: false }]
            },
            lungs: {
                label: "THE LUNGS ü´Å",
                q: "Your lungs breathe in fresh air. What helps them stay healthy?",
                opts: [{ t: "Playing in fresh park air", c: true }, { t: "Holding your breath", c: false }, { t: "Living in a dusty room", c: false }]
            },
            liver: {
                label: "THE LIVER",
                q: "The liver cleans your body of toxins. What helps it do its job?",
                opts: [{ t: "Drinking plenty of water", c: true }, { t: "Eating very salty chips", c: false }, { t: "Skipping breakfast", c: false }]
            },
            stomach: {
                label: "THE STOMACH",
                q: "Your stomach turns food into fuel. What's the best fuel for energy?",
                opts: [{ t: "Veggie and fruit snacks", c: true }, { t: "Ice cream for dinner", c: false }, { t: "Drinking juice only", c: false }]
            }
        };

        function loadQuest(id) {
            audio.playSound('click');
            document.getElementById('intro-view').style.display = 'none';
            document.getElementById('quest-view').style.display = 'block';

            const data = quests[id];
            document.getElementById('m-label').textContent = `MISSION: ${data.label}`;
            document.getElementById('m-question').textContent = data.q;

            const grid = document.getElementById('m-options');
            grid.innerHTML = '';

            data.opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn-option';
                btn.textContent = opt.t;
                btn.onclick = () => check(opt, btn, id);
                grid.appendChild(btn);
            });
        }

        function check(opt, btn, id) {
            if (opt.c) {
                audio.playSound('correct');
                btn.classList.add('correct');
                solved.add(id);
                stars += 40;
                document.getElementById('star-val').textContent = stars;
                document.getElementById('org-' + id).classList.add('solved');

                setTimeout(() => {
                    if (solved.size === 5) {
                        showResult();
                    } else {
                        document.getElementById('quest-view').style.display = 'none';
                        document.getElementById('intro-view').style.display = 'block';
                    }
                }, 1500);
            } else {
                audio.playSound('wrong');
                btn.classList.add('wrong');
                setTimeout(() => btn.classList.remove('wrong'), 1000);
            }
        }

        function showResult() {
            document.getElementById('result-screen').style.display = 'flex';
            document.getElementById('total-stars').textContent = stars;
            tracker.addStars(stars);
            tracker.completeGame('body-quest', stars, 100);

            if (window.saveGameProgress) {
                window.saveGameProgress(GAME_ID, {
                    score: stars,
                    completed: true,
                    correctAnswers: solved.size,
                    attempts: 5 // Fixed 5 organs
                });
            }
        }
    </script>
</body>

</html>