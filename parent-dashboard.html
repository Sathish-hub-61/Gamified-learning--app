<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Parent dashboard for monitoring child's learning progress">
    <title>Parent Dashboard - PlayLearn</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/global.css">

    <style>
        body {
            background: var(--neutral-bg);
            min-height: 100vh;
            padding: var(--spacing-md);
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .dashboard-header {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-md);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .dashboard-title {
            color: var(--neutral-dark);
            margin: 0;
        }

        .back-button {
            text-decoration: none;
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .overview-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-md);
            text-align: center;
        }

        .overview-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-sm);
        }

        .overview-value {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            color: var(--primary-purple);
            margin-bottom: var(--spacing-xs);
        }

        .overview-label {
            color: var(--neutral-medium);
            font-size: var(--font-size-base);
        }

        .section-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-md);
        }

        .section-title {
            color: var(--neutral-dark);
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--neutral-bg);
        }

        .game-progress-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            background: var(--neutral-bg);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
        }

        .game-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .game-icon {
            font-size: var(--font-size-2xl);
        }

        .game-details h4 {
            margin: 0 0 var(--spacing-xs) 0;
            color: var(--neutral-dark);
        }

        .game-stats {
            display: flex;
            gap: var(--spacing-lg);
            font-size: var(--font-size-sm);
            color: var(--neutral-medium);
        }

        .badge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: var(--spacing-md);
        }

        .badge-item {
            background: var(--neutral-bg);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            text-align: center;
            transition: all var(--transition-base);
        }

        .badge-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .badge-icon-display {
            font-size: 3rem;
            margin-bottom: var(--spacing-sm);
        }

        .badge-name {
            font-size: var(--font-size-sm);
            color: var(--neutral-dark);
            font-weight: 600;
        }

        .badge-date {
            font-size: var(--font-size-xs);
            color: var(--neutral-medium);
            margin-top: var(--spacing-xs);
        }

        .empty-state {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--neutral-medium);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-md);
        }

        .settings-section {
            background: var(--neutral-bg);
            padding: var(--spacing-lg);
            border-radius: var(--radius-md);
            margin-top: var(--spacing-lg);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--neutral-light);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info h4 {
            margin: 0 0 var(--spacing-xs) 0;
            color: var(--neutral-dark);
        }

        .setting-info p {
            margin: 0;
            font-size: var(--font-size-sm);
            color: var(--neutral-medium);
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--neutral-light);
            transition: 0.4s;
            border-radius: 30px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked+.toggle-slider {
            background-color: var(--primary-purple);
        }

        input:checked+.toggle-slider:before {
            transform: translateX(30px);
        }

        .action-buttons {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .overview-grid {
                grid-template-columns: 1fr;
            }

            .game-progress-item {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-sm);
            }
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="header-content">
                <h1 class="dashboard-title">üë®‚Äçüë©‚Äçüëß Parent Dashboard</h1>
                <a href="game-hub.html" class="btn btn-primary back-button">
                    ‚Üê Back to Games
                </a>
            </div>
        </div>

        <!-- Overview Cards -->
        <div class="overview-grid">
            <div class="overview-card">
                <div class="overview-icon">‚≠ê</div>
                <div class="overview-value" id="total-stars">0</div>
                <div class="overview-label">Total Stars Earned</div>
            </div>

            <div class="overview-card">
                <div class="overview-icon">üèÜ</div>
                <div class="overview-value" id="total-badges">0</div>
                <div class="overview-label">Badges Unlocked</div>
            </div>

            <div class="overview-card">
                <div class="overview-icon">üéÆ</div>
                <div class="overview-value" id="games-completed">0</div>
                <div class="overview-label">Games Completed</div>
            </div>

            <div class="overview-card">
                <div class="overview-icon">‚è±Ô∏è</div>
                <div class="overview-value" id="session-time">0m</div>
                <div class="overview-label">Session Time</div>
            </div>
        </div>

        <!-- Game Progress -->
        <div class="section-card">
            <h2 class="section-title">üìä Game Progress</h2>
            <div id="game-progress-list">
                <!-- Populated by JavaScript -->
            </div>
        </div>

        <!-- Badges Earned -->
        <div class="section-card">
            <h2 class="section-title">üèÜ Badges Earned</h2>
            <div id="badges-container">
                <!-- Populated by JavaScript -->
            </div>
        </div>

        <!-- Settings -->
        <div class="section-card">
            <h2 class="section-title">‚öôÔ∏è Settings</h2>
            <div class="settings-section">
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Safety Module Access</h4>
                        <p>Allow access to personal safety learning content</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="safety-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Sound Effects</h4>
                        <p>Enable background music and sound effects</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="sound-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="exportProgress()">
                    üì• Export Progress Report
                </button>
                <button class="btn btn-success" onclick="resetProgress()" style="background: var(--warning);">
                    üîÑ Reset All Progress
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/progress-tracker.js"></script>
    <script src="js/audio-manager.js"></script>
    <script>
        const progressTracker = new ProgressTracker();
        const audioManager = new AudioManager();

        // Load and display data
        function loadDashboard() {
            const summary = progressTracker.getSummary();

            // Update overview cards
            document.getElementById('total-stars').textContent = summary.totalStars;
            document.getElementById('total-badges').textContent = summary.badgesEarned;
            document.getElementById('games-completed').textContent = summary.gamesCompleted;
            document.getElementById('session-time').textContent = summary.sessionTime;

            // Display game progress
            displayGameProgress(summary.gameData);

            // Display badges
            displayBadges(summary.badges);

            // Load settings
            loadSettings();
        }

        function displayGameProgress(gameData) {
            const container = document.getElementById('game-progress-list');

            if (gameData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üéÆ</div>
                        <p>No games completed yet. Encourage your child to start playing!</p>
                    </div>
                `;
                return;
            }

            const gameNames = {
                'eco-hero-quest': { name: 'Eco Hero Quest', icon: 'üåç' },
                'safety-shield': { name: 'Safety Shield Adventure', icon: 'üõ°Ô∏è' }
            };

            container.innerHTML = gameData.map(game => {
                const gameInfo = gameNames[game.id] || { name: game.id, icon: 'üéÆ' };
                const date = new Date(game.completedAt).toLocaleDateString();

                return `
                    <div class="game-progress-item">
                        <div class="game-info">
                            <div class="game-icon">${gameInfo.icon}</div>
                            <div class="game-details">
                                <h4>${gameInfo.name}</h4>
                                <div class="game-stats">
                                    <span>‚≠ê ${game.score} stars</span>
                                    <span>üéØ ${game.accuracy}% accuracy</span>
                                    <span>üìÖ ${date}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function displayBadges(badges) {
            const container = document.getElementById('badges-container');

            if (badges.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üèÜ</div>
                        <p>No badges earned yet. Keep playing to unlock achievements!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="badge-grid">
                    ${badges.map(badge => {
                const date = new Date(badge.unlockedAt).toLocaleDateString();
                return `
                            <div class="badge-item">
                                <div class="badge-icon-display">${badge.icon}</div>
                                <div class="badge-name">${badge.name}</div>
                                <div class="badge-date">${date}</div>
                            </div>
                        `;
            }).join('')}
                </div>
            `;
        }

        function loadSettings() {
            // Load safety module setting
            const safetyEnabled = localStorage.getItem('safetyModuleEnabled') !== 'false';
            document.getElementById('safety-toggle').checked = safetyEnabled;

            // Load sound setting
            const soundEnabled = !audioManager.isMuted;
            document.getElementById('sound-toggle').checked = soundEnabled;
        }

        // Settings handlers
        document.getElementById('safety-toggle').addEventListener('change', function () {
            localStorage.setItem('safetyModuleEnabled', this.checked);
            alert(this.checked
                ? 'Safety module enabled'
                : 'Safety module disabled. The game will be hidden from the game hub.');
        });

        document.getElementById('sound-toggle').addEventListener('change', function () {
            if (this.checked !== !audioManager.isMuted) {
                audioManager.toggleMute();
            }
        });

        // Export progress
        function exportProgress() {
            const summary = progressTracker.getSummary();
            const report = {
                generatedAt: new Date().toISOString(),
                totalStars: summary.totalStars,
                badgesEarned: summary.badgesEarned,
                gamesCompleted: summary.gamesCompleted,
                sessionTime: summary.sessionTime,
                overallProgress: summary.overallProgress,
                badges: summary.badges,
                gameData: summary.gameData
            };

            const dataStr = JSON.stringify(report, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `playlearn-progress-${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);

            alert('Progress report downloaded! üì•');
        }

        // Reset progress
        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                if (confirm('This will delete all stars, badges, and game progress. Continue?')) {
                    progressTracker.reset();

                    // Also reset adaptive engine
                    if (window.AdaptiveEngine) {
                        const engine = new window.AdaptiveEngine();
                        engine.reset();
                    }

                    alert('All progress has been reset. ‚úÖ');
                    loadDashboard();
                }
            }
        }

        // Initialize
        window.addEventListener('load', loadDashboard);
    </script>
</body>

</html>