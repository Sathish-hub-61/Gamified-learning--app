<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Learn about personal safety through interactive scenarios">
    <title>Safety Shield Adventure - PlayLearn</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/global.css">

    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: var(--spacing-md);
        }

        .game-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .game-header {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-md);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }

        .game-title {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin: 0;
        }

        .shield-display {
            display: flex;
            gap: var(--spacing-xs);
            align-items: center;
        }

        .shield-icon {
            font-size: var(--font-size-xl);
            opacity: 0.3;
            transition: all var(--transition-base);
        }

        .shield-icon.active {
            opacity: 1;
            animation: pulse 1s ease infinite;
        }

        .level-badge {
            background: var(--secondary-lavender);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            font-weight: 600;
        }

        .score-display {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
        }

        .score-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-weight: 600;
        }

        .progress-section {
            margin-top: var(--spacing-md);
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-sm);
            color: var(--neutral-medium);
        }

        .question-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-lg);
            animation: fadeIn 0.5s ease;
        }

        .safety-notice {
            background: var(--secondary-lavender);
            color: var(--white);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-lg);
            text-align: center;
            font-weight: 600;
        }

        .question-text {
            font-size: var(--font-size-xl);
            color: var(--neutral-dark);
            margin-bottom: var(--spacing-xl);
            text-align: center;
            line-height: 1.6;
        }

        .options-container {
            display: grid;
            gap: var(--spacing-md);
        }

        .option-button {
            background: var(--neutral-bg);
            border: 3px solid transparent;
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            font-size: var(--font-size-lg);
            text-align: left;
            cursor: pointer;
            transition: all var(--transition-base);
            position: relative;
        }

        .option-button:hover:not(.disabled) {
            transform: translateX(10px);
            border-color: var(--primary-purple);
            background: var(--white);
            box-shadow: var(--shadow-md);
        }

        .option-button.correct {
            background: var(--success);
            color: var(--white);
            border-color: var(--success);
            animation: correctPulse 0.5s ease;
        }

        .option-button.wrong {
            background: var(--error);
            color: var(--white);
            border-color: var(--error);
            animation: shake 0.5s ease;
        }

        .option-button.disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        @keyframes correctPulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            75% {
                transform: translateX(10px);
            }
        }

        .feedback-section {
            background: var(--neutral-bg);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-top: var(--spacing-lg);
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .feedback-section.show {
            display: block;
        }

        .feedback-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: var(--spacing-sm);
        }

        .feedback-text {
            text-align: center;
            font-size: var(--font-size-lg);
            color: var(--neutral-dark);
            margin-bottom: var(--spacing-md);
        }

        .next-button {
            width: 100%;
            margin-top: var(--spacing-md);
        }

        .completion-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: var(--spacing-2xl);
            text-align: center;
            box-shadow: var(--shadow-lg);
            animation: fadeIn 0.8s ease;
        }

        .completion-icon {
            font-size: 5rem;
            margin-bottom: var(--spacing-md);
            animation: bounce 1s ease infinite;
        }

        .completion-title {
            color: var(--primary-purple);
            margin-bottom: var(--spacing-md);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
        }

        .stat-box {
            background: var(--neutral-bg);
            padding: var(--spacing-lg);
            border-radius: var(--radius-md);
        }

        .stat-value {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--primary-purple);
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--neutral-medium);
            margin-top: var(--spacing-xs);
        }

        .action-buttons {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .question-text {
                font-size: var(--font-size-lg);
            }

            .option-button {
                font-size: var(--font-size-base);
            }
        }
    </style>
</head>

<body>
    <div class="game-container">
        <!-- Game Header -->
        <div class="game-header">
            <div class="header-top">
                <h2 class="game-title">
                    üõ°Ô∏è Safety Shield Adventure
                    <span class="level-badge" id="level-display">Level 1</span>
                </h2>
                <div class="score-display">
                    <div class="shield-display">
                        <span class="shield-icon" id="shield-1">üõ°Ô∏è</span>
                        <span class="shield-icon" id="shield-2">üõ°Ô∏è</span>
                        <span class="shield-icon" id="shield-3">üõ°Ô∏è</span>
                    </div>
                    <div class="score-item">
                        ‚≠ê <span id="current-score">0</span>
                    </div>
                </div>
            </div>
            <div class="progress-section">
                <div class="progress-label">
                    <span>Progress</span>
                    <span id="question-counter">0/10</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Question Section -->
        <div id="question-section">
            <div class="question-card">
                <div class="safety-notice">
                    üíô Remember: You are safe, smart, and strong!
                </div>
                <p class="question-text" id="question-text">Loading...</p>
                <div class="options-container" id="options-container"></div>
                <div class="feedback-section" id="feedback-section">
                    <div class="feedback-icon" id="feedback-icon"></div>
                    <p class="feedback-text" id="feedback-text"></p>
                    <button class="btn btn-primary next-button" id="next-button">
                        Next Question ‚Üí
                    </button>
                </div>
            </div>
        </div>

        <!-- Completion Section -->
        <div id="completion-section" style="display: none;">
            <div class="completion-card">
                <div class="completion-icon">üõ°Ô∏è</div>
                <h1 class="completion-title">Safety Shield Complete!</h1>
                <p>You've built a strong safety shield! You know how to stay safe! üí™</p>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="final-score">0</div>
                        <div class="stat-label">Total Stars</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="final-accuracy">0%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="final-level">1</div>
                        <div class="stat-label">Final Level</div>
                    </div>
                </div>

                <div id="badge-unlock" style="display: none; margin: var(--spacing-lg) 0;">
                    <h3>üéâ New Badge Unlocked!</h3>
                    <div style="font-size: 4rem; margin: var(--spacing-md) 0;">üõ°Ô∏è</div>
                    <p style="font-size: var(--font-size-lg); font-weight: 600;">Safety Champion</p>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-success" onclick="playAgain()">
                        üîÑ Play Again
                    </button>
                    <button class="btn btn-primary" onclick="backToHub()">
                        üè† Back to Hub
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/game-data.js"></script>
    <script src="js/adaptive-engine.js"></script>
    <script src="js/progress-tracker.js"></script>
    <script src="js/audio-manager.js"></script>
    <script>
        // Initialize
        const adaptiveEngine = new AdaptiveEngine();
        const progressTracker = new ProgressTracker();
        const audioManager = new AudioManager();

        let scenarios = [];
        let currentQuestionIndex = 0;
        let currentScore = 0;
        let correctAnswers = 0;
        let totalQuestions = 10;
        let shieldStrength = 0;

        // Load scenarios
        function loadScenarios() {
            // Use embedded data from game-data.js
            if (window.SAFETY_SCENARIOS) {
                scenarios = window.SAFETY_SCENARIOS.scenarios;

                // Load saved progress
                adaptiveEngine.loadProgress();

                // Start game
                showQuestion();
            } else {
                console.error('Game data not loaded');
                alert('Error loading game data. Please refresh the page.');
            }
        }

        // Update shield display
        function updateShield() {
            const shields = [
                document.getElementById('shield-1'),
                document.getElementById('shield-2'),
                document.getElementById('shield-3')
            ];

            shields.forEach((shield, index) => {
                if (index < shieldStrength) {
                    shield.classList.add('active');
                } else {
                    shield.classList.remove('active');
                }
            });
        }

        // Show current question
        function showQuestion() {
            if (currentQuestionIndex >= totalQuestions) {
                showCompletion();
                return;
            }

            // Get question based on current level
            const currentLevel = adaptiveEngine.getCurrentLevel();
            const levelScenarios = scenarios.filter(s => s.level === currentLevel);

            const scenario = levelScenarios.length > 0
                ? levelScenarios[Math.floor(Math.random() * levelScenarios.length)]
                : scenarios[currentQuestionIndex % scenarios.length];

            // Update UI
            document.getElementById('question-text').textContent = scenario.question;
            document.getElementById('level-display').textContent = `Level ${currentLevel}`;
            document.getElementById('question-counter').textContent = `${currentQuestionIndex + 1}/${totalQuestions}`;

            const progress = ((currentQuestionIndex + 1) / totalQuestions) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';

            // Render options
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';

            scenario.options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = option.text;
                button.onclick = () => selectAnswer(option, scenario.options);
                optionsContainer.appendChild(button);
            });

            // Hide feedback
            document.getElementById('feedback-section').classList.remove('show');
        }

        // Handle answer selection
        function selectAnswer(selectedOption, allOptions) {
            // Disable all buttons
            const buttons = document.querySelectorAll('.option-button');
            buttons.forEach(btn => {
                btn.classList.add('disabled');
                btn.onclick = null;
            });

            // Mark correct/wrong
            buttons.forEach((btn, index) => {
                if (allOptions[index].correct) {
                    btn.classList.add('correct');
                } else if (btn.textContent === selectedOption.text && !selectedOption.correct) {
                    btn.classList.add('wrong');
                }
            });

            // Update scores
            const isCorrect = selectedOption.correct;
            adaptiveEngine.recordAnswer(isCorrect);

            if (isCorrect) {
                correctAnswers++;
                currentScore += selectedOption.points;
                progressTracker.addStars(selectedOption.points);
                audioManager.playSound('correct');

                // Strengthen shield
                if (shieldStrength < 3) {
                    shieldStrength++;
                    updateShield();
                }
            } else {
                audioManager.playSound('wrong');
            }

            // Update UI
            document.getElementById('current-score').textContent = currentScore;

            // Show feedback
            const feedbackSection = document.getElementById('feedback-section');
            const feedbackIcon = document.getElementById('feedback-icon');
            const feedbackText = document.getElementById('feedback-text');

            feedbackIcon.textContent = isCorrect ? '‚úÖ' : 'üí°';
            feedbackText.textContent = selectedOption.feedback;
            feedbackSection.classList.add('show');
        }

        // Next question
        document.getElementById('next-button').addEventListener('click', function () {
            currentQuestionIndex++;
            showQuestion();
        });

        // Show completion
        function showCompletion() {
            document.getElementById('question-section').style.display = 'none';
            document.getElementById('completion-section').style.display = 'block';

            const accuracy = Math.round((correctAnswers / totalQuestions) * 100);
            const finalLevel = adaptiveEngine.getCurrentLevel();

            document.getElementById('final-score').textContent = currentScore;
            document.getElementById('final-accuracy').textContent = accuracy + '%';
            document.getElementById('final-level').textContent = finalLevel;

            // Save completion
            progressTracker.completeGame('safety-shield', currentScore, accuracy);

            // Check for badge
            if (progressTracker.hasBadge('safety-champion')) {
                document.getElementById('badge-unlock').style.display = 'block';
                audioManager.playSound('badge');
            }

            audioManager.playSound('success');
        }

        // Play again
        function playAgain() {
            currentQuestionIndex = 0;
            currentScore = 0;
            correctAnswers = 0;
            shieldStrength = 0;
            updateShield();
            document.getElementById('question-section').style.display = 'block';
            document.getElementById('completion-section').style.display = 'none';
            showQuestion();
        }

        // Back to hub
        function backToHub() {
            window.location.href = 'game-hub.html';
        }

        // Initialize on load
        window.addEventListener('load', function () {
            audioManager.initBackgroundMusic('forest');
            updateShield();
            loadScenarios();
        });
    </script>
</body>

</html>